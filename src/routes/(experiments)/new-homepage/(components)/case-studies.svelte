<script lang="ts">
    import { classNames } from '$lib/utils/classnames';
    import ProductHunt from '../(assets)/logos/product-hunt.svg';
    import Avatar from '../(assets)/avatar.png';

    import { createToggleGroup, melt } from '@melt-ui/svelte';

    const studies = [
        {
            logo: ProductHunt,
            headline:
                'Product Hunt has leveraged Appwrite to transform logistics and supply chain management for circular businesses',
            blurb: 'Been a huge supporter of Appwrite for over a year, championing it even at the companies I was working at.',
            name: 'Terry Lennon',
            title: 'Engineer at Product Hunt',
            avatar: Avatar,
            url: '/case-studies/product-hunt'
        },
        {
            logo: ProductHunt,
            headline:
                'Product Hunt has leveraged Appwrite to transform logistics and supply chain management for circular businesses',
            blurb: 'Been a huge supporter of Appwrite for over a year, championing it even at the companies I was working at.',
            name: 'Terry Lennon',
            title: 'Engineer at Product Hunt',
            avatar: Avatar,
            url: '/case-studies/product-hunt'
        },
        {
            logo: ProductHunt,
            headline:
                'Product Hunt has leveraged Appwrite to transform logistics and supply chain management for circular businesses',
            blurb: 'Been a huge supporter of Appwrite for over a year, championing it even at the companies I was working at.',
            name: 'Terry Lennon',
            title: 'Engineer at Product Hunt',
            avatar: Avatar,
            url: '/case-studies/product-hunt'
        }
    ];

    const {
        elements: { root, item },
        helpers: { isPressed }
    } = createToggleGroup({
        type: 'single',
        defaultValue: '0',
        loop: true
    });
</script>

<div
    class={classNames(
        'gradient-background relative flex min-h-[60vh] items-center justify-center overflow-hidden',
        'before:absolute before:inset-0 before:top-0 before:left-0 before:-z-10 before:block before:h-full before:bg-[radial-gradient(circle_at_120%_-50%,_hsla(248,_99%,_70%,_0.3)_0,_transparent_40%)] before:blur-2xl',
        'after:absolute after:inset-0 after:top-0 after:right-0 after:-z-10 after:mt-auto after:mb-0 after:block after:h-full after:bg-[radial-gradient(circle_at_-15%_125%,_hsla(343,_98%,_60%,_0.2)_0px,_transparent_40%)] after:blur-2xl'
    )}
>
    <div class="container flex h-full items-center gap-4" use:melt={$root}>
        {#each studies as study, i}
            <div
                class={classNames(
                    'data-[state="on"]:border-smooth grid h-[425px] cursor-pointer place-content-center place-items-center overflow-hidden rounded-2xl border border-transparent py-6 px-12 backdrop-blur-3xl transition-all duration-400 ease-in-out [grid-template-areas:"stack"]',
                    'group/card hover:bg-black/24 data-[state="on"]:[flex-basis:70%] data-[state="on"]:bg-black/24 data-[state="off"]:[flex-basis:15%] data-[state="off"]:bg-black/16'
                )}
                role="figure"
                use:melt={$item(i.toString())}
            >
                <img
                    src={study.logo}
                    alt={study.headline}
                    class={classNames(
                        'visible opacity-100 transition-all [grid-area:stack]',
                        "group-[&[data-state='on']]/card:invisible group-[&[data-state='on']]/card:opacity-0",
                        'brightness-50'
                    )}
                />

                <div
                    class={classNames(
                        'invisible space-y-4 opacity-0 transition-opacity delay-400 [grid-area:stack]',
                        "group-[&[data-state='on']]/card:visible group-[&[data-state='on']]/card:opacity-100"
                    )}
                >
                    <img src={study.logo} alt={study.headline} />
                    <span class="text-title text-primary"
                        >{study.headline}<span class="text-accent">_</span></span
                    >

                    <div class="border-smooth mt-8 border-t border-dashed pt-8">
                        <div class="text-primary text-sub-body max-w-[60%] font-medium">
                            {study.blurb}
                        </div>

                        <div class="mt-4 flex justify-between">
                            <div class="flex gap-2">
                                <img src={study.avatar} alt={study.headline} class="size-6" />
                                <span class="text-caption">{study.name}, {study.title}</span>
                            </div>
                            <a href={study.url} class="text-primary">Read customer story</a>
                        </div>
                    </div>
                </div>
            </div>
        {/each}
    </div>
</div>

<style>
    :root {
        --spring: cubic-bezier(1, -0.4, 0.35, 0.95);
    }
</style>
